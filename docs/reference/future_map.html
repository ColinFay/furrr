<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Apply a function to each element of a vector via futures — future_map • furrr</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
<meta property="og:title" content="Apply a function to each element of a vector via futures — future_map" />

<meta property="og:description" content="These functions work exactly the same as purrr::map() functions, but allow
you to run the map in parallel. There are a number of future.* arguments
to allow you to fine tune the parallel processing. The documentation is
adapted from both purrr::map(), and future.apply::future_lapply(),
so look there for more details." />
<meta name="twitter:card" content="summary" />


<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->




  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">furrr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/DavisVaughan/furrr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Apply a function to each element of a vector via futures</h1>
    <small>Source: <a href='https://github.com/DavisVaughan/furrr/blob/master/R/future_map.R'><code>R/future_map.R</code></a></small>
    <div class="hidden name"><code>future_map.Rd</code></div>
    </div>

    
    <p>These functions work exactly the same as <code><a href='http://www.rdocumentation.org/packages/purrr/topics/map'>purrr::map()</a></code> functions, but allow
you to run the map in parallel. There are a number of <code>future.*</code> arguments
to allow you to fine tune the parallel processing. The documentation is
adapted from both <code><a href='http://www.rdocumentation.org/packages/purrr/topics/map'>purrr::map()</a></code>, and <code><a href='http://www.rdocumentation.org/packages/future.apply/topics/future_lapply'>future.apply::future_lapply()</a></code>,
so look there for more details.</p>
    

    <pre class="usage"><span class='fu'>future_map</span>(<span class='no'>.x</span>, <span class='no'>.f</span>, <span class='no'>...</span>, <span class='kw'>future.globals</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>future.packages</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>future.seed</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>future.lazy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>future.scheduling</span> <span class='kw'>=</span> <span class='fl'>1</span>)

<span class='fu'>future_map_chr</span>(<span class='no'>.x</span>, <span class='no'>.f</span>, <span class='no'>...</span>, <span class='kw'>future.globals</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>future.packages</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>future.seed</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>future.lazy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>future.scheduling</span> <span class='kw'>=</span> <span class='fl'>1</span>)

<span class='fu'>future_map_dbl</span>(<span class='no'>.x</span>, <span class='no'>.f</span>, <span class='no'>...</span>, <span class='kw'>future.globals</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>future.packages</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>future.seed</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>future.lazy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>future.scheduling</span> <span class='kw'>=</span> <span class='fl'>1</span>)

<span class='fu'>future_map_int</span>(<span class='no'>.x</span>, <span class='no'>.f</span>, <span class='no'>...</span>, <span class='kw'>future.globals</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>future.packages</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>future.seed</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>future.lazy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>future.scheduling</span> <span class='kw'>=</span> <span class='fl'>1</span>)

<span class='fu'>future_map_lgl</span>(<span class='no'>.x</span>, <span class='no'>.f</span>, <span class='no'>...</span>, <span class='kw'>future.globals</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>future.packages</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>future.seed</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>future.lazy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>future.scheduling</span> <span class='kw'>=</span> <span class='fl'>1</span>)

<span class='fu'>future_map_dfr</span>(<span class='no'>.x</span>, <span class='no'>.f</span>, <span class='no'>...</span>, <span class='kw'>.id</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>future.globals</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>future.packages</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>future.seed</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>future.lazy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>future.scheduling</span> <span class='kw'>=</span> <span class='fl'>1</span>)

<span class='fu'>future_map_dfc</span>(<span class='no'>.x</span>, <span class='no'>.f</span>, <span class='no'>...</span>, <span class='kw'>future.globals</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>future.packages</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>future.seed</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>future.lazy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>future.scheduling</span> <span class='kw'>=</span> <span class='fl'>1</span>)

<span class='fu'>future_map_if</span>(<span class='no'>.x</span>, <span class='no'>.p</span>, <span class='no'>.f</span>, <span class='no'>...</span>, <span class='kw'>future.globals</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>future.packages</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>future.seed</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>future.lazy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>future.scheduling</span> <span class='kw'>=</span> <span class='fl'>1</span>)

<span class='fu'>future_map_at</span>(<span class='no'>.x</span>, <span class='no'>.at</span>, <span class='no'>.f</span>, <span class='no'>...</span>, <span class='kw'>future.globals</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>future.packages</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>future.seed</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>future.lazy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>future.scheduling</span> <span class='kw'>=</span> <span class='fl'>1</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>.x</th>
      <td><p>A list or atomic vector.</p></td>
    </tr>
    <tr>
      <th>.f</th>
      <td><p>A function, formula, or atomic vector.</p>
<p>If a <strong>function</strong>, it is used as is.</p>
<p>If a <strong>formula</strong>, e.g. <code>~ .x + 2</code>, it is converted to a function. There
are three ways to refer to the arguments:</p><ul>
<li><p>For a single argument function, use <code>.</code></p></li>
<li><p>For a two argument function, use <code>.x</code> and <code>.y</code></p></li>
<li><p>For more arguments, use <code>..1</code>, <code>..2</code>, <code>..3</code> etc</p></li>
</ul>

<p>This syntax allows you to create very compact anonymous functions.</p>
<p>If <strong>character vector</strong>, <strong>numeric vector</strong>, or <strong>list</strong>, it
is converted to an extractor function. Character vectors index by name
and numeric vectors index by position; use a list to index by position
and name at different levels. Within a list, wrap strings in <code>get-attr()</code>
to extract named attributes. If a component is not present, the value of
<code>.default</code> will be returned.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments passed on to <code>.f</code>.</p></td>
    </tr>
    <tr>
      <th>future.globals</th>
      <td><p>A logical, a character vector, or a named list for
controlling how globals are handled. For details, see below section.</p></td>
    </tr>
    <tr>
      <th>future.packages</th>
      <td><p>(optional) a character vector specifying packages
to be attached in the R environment evaluating the future.</p></td>
    </tr>
    <tr>
      <th>future.seed</th>
      <td><p>A logical or an integer (of length one or seven),
or a list of <code>length(.x)</code> with pre-generated random seeds.
For details, see below section.</p></td>
    </tr>
    <tr>
      <th>future.lazy</th>
      <td><p>Specifies whether the futures should be resolved
lazily or eagerly (default).</p></td>
    </tr>
    <tr>
      <th>future.scheduling</th>
      <td><p>Average number of futures ("chunks") per worker.
If <code>0.0</code>, then a single future is used to process all elements
of <code>.x</code>.
If <code>1.0</code> or <code>TRUE</code>, then one future per worker is used.
If <code>2.0</code>, then each worker will process two futures
(if there are enough elements in <code>.x</code>).
If <code>Inf</code> or <code>FALSE</code>, then one future per element of
<code>.x</code> is used.</p></td>
    </tr>
    <tr>
      <th>.id</th>
      <td><p>If not <code>NULL</code> a variable with this name will be created
giving either the name or the index of the data frame.</p></td>
    </tr>
    <tr>
      <th>.p</th>
      <td><p>A single predicate function, a formula describing such a
predicate function, or a logical vector of the same length as <code>.x</code>.
Alternatively, if the elements of <code>.x</code> are themselves lists of
objects, a string indicating the name of a logical element in the
inner lists. Only those elements where <code>.p</code> evaluates to
<code>TRUE</code> will be modified.</p></td>
    </tr>
    <tr>
      <th>.at</th>
      <td><p>A character vector of names or a numeric vector of
positions. Only those elements corresponding to <code>.at</code> will be
modified.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>All functions return a vector the same length as <code>.x</code>.</p>
<p><code>future_map()</code> returns a list, <code>future_map_lgl()</code> a logical vector,
<code>future_map_int()</code> an integer vector, <code>future_map_dbl()</code> a double vector,
and <code>future_map_chr()</code> a character vector.
The output of <code>.f</code> will be automatically typed upwards,
e.g. logical -&gt; integer -&gt; double -&gt; character.</p>
    
    <h2 class="hasAnchor" id="global-variables"><a class="anchor" href="#global-variables"></a>Global variables</h2>

    
    <p>Argument <code>future.globals</code> may be used to control how globals
should be handled similarly how the <code>globals</code> argument is used with
<code>future()</code>.
Since all function calls use the same set of globals, this function can do
any gathering of globals upfront (once), which is more efficient than if
it would be done for each future independently.
If <code>TRUE</code>, <code>NULL</code> or not is specified (default), then globals
are automatically identified and gathered.
If a character vector of names is specified, then those globals are gathered.
If a named list, then those globals are used as is.
In all cases, <code>.f</code> and any <code>...</code> arguments are automatically
passed as globals to each future created as they are always needed.</p>
    
    <h2 class="hasAnchor" id="reproducible-random-number-generation-rng-"><a class="anchor" href="#reproducible-random-number-generation-rng-"></a>Reproducible random number generation (RNG)</h2>

    
    <p>Unless <code>future.seed = FALSE</code>, this function guarantees to generate
the exact same sequence of random numbers <em>given the same initial
seed / RNG state</em> - this regardless of type of futures and scheduling
("chunking") strategy.</p>
<p>RNG reproducibility is achieved by pregenerating the random seeds for all
iterations (over <code>.x</code>) by using L'Ecuyer-CMRG RNG streams.  In each
iteration, these seeds are set before calling <code>.f(.x[[ii]], ...)</code>.
<em>Note, for large <code>length(.x)</code> this may introduce a large overhead.</em>
As input (<code>future.seed</code>), a fixed seed (integer) may be given, either
as a full L'Ecuyer-CMRG RNG seed (vector of 1+6 integers) or as a seed
generating such a full L'Ecuyer-CMRG seed.
If <code>future.seed = TRUE</code>, then <code><a href='http://www.rdocumentation.org/packages/base/topics/Random'>.Random.seed</a></code>
is returned if it holds a L'Ecuyer-CMRG RNG seed, otherwise one is created
randomly.
If <code>future.seed = NA</code>, a L'Ecuyer-CMRG RNG seed is randomly created.
If none of the function calls <code>.f(.x[[ii]], ...)</code> uses random number
generation, then <code>future.seed = FALSE</code> may be used.</p>
<p>In addition to the above, it is possible to specify a pre-generated
sequence of RNG seeds as a list such that
<code>length(future.seed) == length(.x)</code> and where each element is an
integer seed that can be assigned to <code><a href='http://www.rdocumentation.org/packages/base/topics/Random'>.Random.seed</a></code>.
Use this alternative with caution.
<strong>Note that <code>as.list(seq_along(.x))</code> is <em>not</em> a valid set of such
<code>.Random.seed</code> values.</strong></p>
<p>In all cases but <code>future.seed = FALSE</code>, the RNG state of the calling
R processes after this function returns is guaranteed to be
"forwarded one step" from the RNG state that was before the call and
in the same way regardless of <code>future.seed</code>, <code>future.scheduling</code>
and future strategy used.  This is done in order to guarantee that an <span style="R">R</span>
script calling <code>future_map()</code> multiple times should be numerically
reproducible given the same initial seed.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='fu'>library</span>(<span class='no'>furrr</span>)
<span class='fu'>library</span>(<span class='no'>dplyr</span>) <span class='co'># for the pipe</span>

<span class='fu'>plan</span>(<span class='no'>multiprocess</span>)

<span class='fl'>1</span>:<span class='fl'>10</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>future_map</span>(<span class='no'>rnorm</span>, <span class='kw'>n</span> <span class='kw'>=</span> <span class='fl'>10</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>future_map_dbl</span>(<span class='no'>mean</span>)</div><div class='output co'>#&gt;  [1] 1.171826 1.860167 2.928960 3.858197 4.731077 5.852965 7.152533 8.817512
#&gt;  [9] 8.942318 9.566968</div><div class='input'>
<span class='co'># If each element of the output is a data frame, use</span>
<span class='co'># map_dfr to row-bind them together:</span>
<span class='no'>mtcars</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>split</span>(<span class='no'>.</span>$<span class='no'>cyl</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>future_map</span>(~ <span class='fu'>lm</span>(<span class='no'>mpg</span> ~ <span class='no'>wt</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>.x</span>)) <span class='kw'>%&gt;%</span>
  <span class='fu'>future_map_dfr</span>(~ <span class='fu'>as.data.frame</span>(<span class='fu'>t</span>(<span class='fu'>as.matrix</span>(<span class='fu'>coef</span>(<span class='no'>.</span>)))))</div><div class='output co'>#&gt;   (Intercept)        wt
#&gt; 1    39.57120 -5.647025
#&gt; 2    28.40884 -2.780106
#&gt; 3    23.86803 -2.192438</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#global-variables">Global variables</a></li>

      <li><a href="#reproducible-random-number-generation-rng-">Reproducible random number generation (RNG)</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Davis Vaughan, Henrik Bengtsson, Matt Dancho.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

